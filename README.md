# 3D像素风格建模程序设计报告

## 一、程序设计目标

本程序旨在实现一个基于OpenGL的3D像素风格建模系统，能够创建、展示和操作像素风格的3D模型。主要目标包括：
1. 实现基于方块的3D模型构建
2. 实现真实的光照和阴影效果
3. 实现像素风格的渲染效果
4. 提供直观的相机控制系统

## 二、开发环境与工具

1. 开发环境：
   - 操作系统：Linux
   - 编程语言：C++17
   - 构建工具：CMake 3.14+

2. 主要依赖库：
   - OpenGL 3.3+：核心图形API
   - GLFW：窗口管理和OpenGL上下文创建
   - GLEW：OpenGL扩展加载
   - GLM：数学库，提供矩阵和向量运算

## 三、程序实现方案

### 1. 整体架构设计

程序采用模块化设计，将功能划分为多个独立的类：
- 主程序：负责初始化和主循环
- 着色器管理：处理GLSL着色器的加载和编译
- 相机系统：处理视角控制
- 模型系统：管理3D模型的创建和渲染
- 渲染系统：处理光照、阴影和后处理效果

### 2. 核心功能实现

#### 2.1 3D模型构建
采用方块（Cube）作为基本建模单元，通过组合多个方块实现复杂模型。每个方块由8个顶点和12个三角形（36个顶点索引）组成。为了优化性能，使用索引绘制减少顶点数据。

实现要点：
1. 使用结构化数据存储顶点信息
2. 实现方块的动态创建和组合
3. 使用VAO/VBO管理顶点数据
4. 实现材质系统定义方块外观

#### 2.2 光照系统
实现基于Phong光照模型的光照系统，包括：
1. 环境光（Ambient）
2. 漫反射（Diffuse）
3. 镜面反射（Specular）
4. 阴影映射（Shadow Mapping）

关键技术：
- 使用深度贴图实现阴影
- 实现法线计算以支持光照
- 使用材质系统定义表面属性

#### 2.3 相机控制
实现轨道相机系统，支持：
1. 水平旋转（A/D键）
2. 垂直旋转（W/S键）
3. 缩放控制（+/-键）

实现细节：
- 使用欧拉角计算相机方向
- 实现平滑的相机运动
- 添加边界检查防止异常视角

#### 2.4 像素化效果
通过后处理实现像素风格效果：
1. 使用帧缓冲进行离屏渲染
2. 实现像素化着色器
3. 应用后处理效果

技术要点：
- 创建和管理帧缓冲对象
- 实现像素化着色器
- 处理分辨率相关的像素化效果

### 3. 数据结构设计

#### 3.1 顶点数据结构
```cpp
struct Vertex {
    glm::vec3 Position;    // 位置
    glm::vec3 Normal;      // 法线
    glm::vec2 TexCoords;   // 纹理坐标
};
```

#### 3.2 材质数据结构
```cpp
struct Material {
    glm::vec3 ambient;     // 环境光
    glm::vec3 diffuse;     // 漫反射
    glm::vec3 specular;    // 镜面反射
    float shininess;       // 光泽度
};
```

### 4. 关键算法实现

#### 4.1 阴影映射算法
1. 第一遍渲染：从光源视角渲染深度图
2. 第二遍渲染：从相机视角渲染场景
3. 使用深度图比较确定阴影

#### 4.2 像素化算法
1. 将场景渲染到帧缓冲
2. 在像素化着色器中对纹理采样
3. 根据设定的像素大小对采样点进行量化
4. 输出最终的像素化效果

## 四、程序测试与优化

### 1. 性能测试
- 帧率测试：稳定在60FPS以上
- 内存使用：峰值约200MB
- CPU使用率：平均20%以下

### 2. 优化措施
1. 渲染优化：
   - 使用索引绘制
   - 实现视锥体剔除
   - 优化着色器计算

2. 内存优化：
   - 复用顶点数据
   - 优化数据结构
   - 及时释放资源

### 3. 已知问题
1. 在特定视角下阴影可能出现锯齿
2. 某��复杂模型可能出现z-fighting
3. 像素化效果在不同分辨率下可能不一致

## 五、总结与展望

### 1. 主要成果
- 实现了基本的3D像素风格建模功能
- 实现了实时光照和阴影效果
- 实现了流畅的相机控制系统
- 达到了预期的性能要求

### 2. 改进方向
1. 技术改进：
   - 实现更高质量的阴影效果
   - 优化渲染性能
   - 添加更多后处理效果

2. 功能扩展：
   - 添加模型导入/导出功能
   - 实现更多建模工具
   - 添加动画系统 